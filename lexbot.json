AWSTemplateFormatVersion: 2010-09-09
Parameters:
  ExcelKey:
    Default: MakeAppointmentChatBot.xlsx
    Type: String
  SourceBucket:
    Default: howwhofeelinvideopackage
    Type: String
Resources:
  ApponintmemtFunction:
    Properties:
      CodeUri:
        Bucket:
          Ref: SourceBucket
        Key: lambda_function.zip
      Description: Schedule a dentist appointment, using Amazon Lex to perform natural
        language understanding
      FunctionName: appointment
      Handler: appointment.lambda_handler
      MemorySize: 512
      Policies:
      - AWSXrayWriteOnlyAccess
      - AWSLambdaExecute
      - AWSLambdaBasicExecutionRole
      - AmazonS3ReadOnlyAccess
      - AmazonLexRunBotsOnly
      Runtime: python3.6
      Timeout: 300
      Tracing: Active
    Type: AWS::Serverless::Function
  LambdaInvokePermission:
    DependsOn: ApponintmemtFunction
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Ref: ApponintmemtFunction
      Principal: lex.amazonaws.com
      SourceArn:
        Fn::Sub: arn:aws:lex:${AWS::Region}:${AWS::AccountId}:intent:*:*
    Type: AWS::Lambda::Permission
  LexBuilderCustomReseources:
    DependsOn:
    - LexBuilderCustomReseourcesFunction
    - LambdaInvokePermission
    Properties:
      ExcelKey:
        Ref: ExcelKey
      ServiceToken:
        Fn::GetAtt:
        - LexBuilderCustomReseourcesFunction
        - Arn
      SourceBucket:
        Ref: SourceBucket
      StackName:
        Ref: AWS::StackName
    Type: Custom::LexBuilder
    Version: 1.0
  LexBuilderCustomReseourcesFunction:
    Properties:
      CodeUri:
        Bucket:
          Ref: SourceBucket
        Key: lex_builder_function.zip
      Handler: main.lambda_handler
      MemorySize: 512
      Policies:
      - AWSXrayWriteOnlyAccess
      - AWSLambdaExecute
      - AWSLambdaBasicExecutionRole
      - AmazonS3ReadOnlyAccess
      - AmazonLexFullAccess
      Runtime: python3.6
      Timeout: 300
      Tracing: Active
    Type: AWS::Serverless::Function
Transform: AWS::Serverless-2016-10-31
